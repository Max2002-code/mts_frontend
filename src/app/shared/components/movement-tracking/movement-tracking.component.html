<div class="tracking-dashboard">

  <!-- SINISTRA: ricerca libro -->
  <div class="left-panel">
    <mat-card class="search-card elevated">
      <mat-card-title>ğŸ” Tracciamento libro</mat-card-title>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Titolo libro</mat-label>
        <input matInput [(ngModel)]="query" placeholder="Es. Harry Potter">
      </mat-form-field>

      <button mat-raised-button color="primary" class="full-width" (click)="search()">
        Cerca
      </button>

      <!-- Messaggi informativi sotto il bottone -->
      <div class="search-feedback" *ngIf="query && !movement">
        <mat-icon color="warn">info</mat-icon>
        <span>Non hai ancora selezionato un libro o il titolo non corrisponde a nessuno.</span>
      </div>

      <div class="search-feedback" *ngIf="query && movement">
        <mat-icon color="primary">check_circle</mat-icon>
        <span>Libro trovato! Vedi lo stato e la cronologia a destra.</span>
      </div>

      <!-- Suggerimenti rapidi -->
      <div class="recent-searches" *ngIf="recentSearches?.length">
        <mat-icon>history</mat-icon>
        <span>Ricerche recenti:</span>
        <div class="recent-items">
          <button mat-stroked-button color="accent" *ngFor="let r of recentSearches" (click)="query=r; search()">
            {{ r }}
          </button>
        </div>
      </div>

      <!-- Filtri stato libro -->
      <div *ngIf="movement" class="status-filters">
        <mat-label>Filtra cronologia per stato:</mat-label>
        <mat-select [(ngModel)]="filterStatus" (selectionChange)="onFilterChange()">
          <mat-option value="Tutti">Tutti</mat-option>
          <mat-option value="Arrivato">Arrivato</mat-option>
          <mat-option value="In Transito">In consegna</mat-option>
          <mat-option value="In Prestito">In prestito</mat-option>
          <mat-option value="Disponibile">Disponibile</mat-option>
        </mat-select>
      </div>

    </mat-card>
  </div>

  <!-- DESTRA: stato libro e cronologia -->
  <div class="right-panel" *ngIf="movement">
    <mat-card class="book-card elevated">

      <!-- HEADER -->
      <div class="book-header">
        <div>
          <h2>{{ movement.bookTitle }}</h2>
          <span class="status-badge" [ngClass]="movement.status | lowercase">
            {{ movement.status }}
          </span>
        </div>
      </div>

      <!-- CRONOLOGIA -->
      <mat-card-content>
        <h4>ğŸ“œ Cronologia</h4>

        <div *ngIf="filteredHistory.length; else noHistory">
          <div class="timeline">
            <div class="timeline-item" *ngFor="let h of filteredHistory">
              <div class="dot" [ngClass]="h.description.toLowerCase()">
                <ng-container [ngSwitch]="h.description">
                  <span *ngSwitchCase="'Arrivato'">âœ…</span>
                  <span *ngSwitchCase="'In Transito'">ğŸšš</span>
                  <span *ngSwitchCase="'In Prestito'">ğŸ“–</span>
                  <span *ngSwitchDefault>ğŸ•’</span>
                </ng-container>
              </div>

              <div class="content">
                <strong>{{ h.date | date:'dd/MM/yyyy' }}</strong>
                <p>{{ h.description }}</p>
              </div>
            </div>
          </div>
        </div>

        <ng-template #noHistory>
          <p class="empty">Nessuna cronologia disponibile</p>
        </ng-template>
      </mat-card-content>

      <!-- AZIONI -->
      <mat-divider></mat-divider>

      <mat-card-content class="actions">
        <mat-form-field appearance="outline">
          <mat-label>Data arrivo</mat-label>
          <input matInput type="date" [(ngModel)]="arrivalInput">
        </mat-form-field>

        <button mat-raised-button color="accent" (click)="setArrival()">
          Segna come arrivato
        </button>
      </mat-card-content>

    </mat-card>
  </div>

</div>
