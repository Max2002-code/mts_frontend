<div class="tracking-dashboard">

  <!-- SINISTRA -->
  <div class="left-panel">
    <mat-card class="search-card elevated">
      <mat-card-title>üîç Tracciamento libro</mat-card-title>

      <!-- AUTOCOMPLETE -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Titolo libro</mat-label>

        <input
          matInput
          [(ngModel)]="query"
          (ngModelChange)="onQueryChange($event)"
          [matAutocomplete]="auto"
          placeholder="Es. Harry Potter"
        />

        <mat-autocomplete
          #auto="matAutocomplete"
          (optionSelected)="onBookSelected($event.option.value)"
        >
          <mat-option
            *ngFor="let book of filteredBooks"
            [value]="book"
          >
            üìò {{ book }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

      <button
        mat-raised-button
        color="primary"
        class="full-width"
        (click)="search()"
      >
        Cerca
      </button>

      <!-- FEEDBACK -->
      <div class="search-feedback error" *ngIf="searched && !movement">
        <mat-icon>info</mat-icon>
        <span>Libro non trovato</span>
      </div>

      <div class="search-feedback success" *ngIf="movement">
        <mat-icon>check_circle</mat-icon>
        <span>Libro trovato</span>
      </div>

      <!-- RICERCHE RECENTI -->
      <div class="recent-searches" *ngIf="recentSearches.length">
        <mat-icon>history</mat-icon>
        <span>Ricerche recenti:</span>

        <div class="recent-items">
          <button
            mat-stroked-button
            *ngFor="let r of recentSearches"
            (click)="onBookSelected(r)"
          >
            {{ r }}
          </button>
        </div>
      </div>

      <!-- FILTRI -->
      <div class="status-filters" *ngIf="movement">
        <mat-label>Filtra cronologia:</mat-label>
        <mat-select [(ngModel)]="filterStatus" (selectionChange)="onFilterChange()">
          <mat-option value="Tutti">Tutti</mat-option>
          <mat-option value="Arrivato">Arrivato</mat-option>
          <mat-option value="In Transito">In consegna</mat-option>
          <mat-option value="In Prestito">In prestito</mat-option>
          <mat-option value="Disponibile">Disponibile</mat-option>
        </mat-select>
      </div>

    </mat-card>
  </div>

  <!-- DESTRA -->
  <div class="right-panel" *ngIf="movement">
    <mat-card class="book-card elevated">

      <!-- HEADER -->
      <div class="book-header">
        <h2>{{ movement.bookTitle }}</h2>
        <span class="status-badge" [ngClass]="movement.status | lowercase">
          {{ movement.status }}
        </span>
      </div>

      <!-- CRONOLOGIA -->
      <mat-card-content>
        <h4>üìú Cronologia</h4>

        <div *ngIf="filteredHistory.length; else noHistory" class="timeline">
          <div class="timeline-item" *ngFor="let h of filteredHistory">
            <div class="dot"></div>
            <div class="content">
              <strong>{{ h.date | date:'dd/MM/yyyy' }}</strong>
              <p>{{ h.description }}</p>
            </div>
          </div>
        </div>

        <ng-template #noHistory>
          <p class="empty">Nessuna cronologia disponibile</p>
        </ng-template>
      </mat-card-content>

      <!-- AZIONI -->
      <mat-divider></mat-divider>

      <mat-card-content class="actions">
        <mat-form-field appearance="outline">
          <mat-label>Data arrivo</mat-label>
          <input matInput type="date" [(ngModel)]="arrivalInput">
        </mat-form-field>

        <button mat-raised-button color="accent" (click)="setArrival()">
          Segna come arrivato
        </button>
      </mat-card-content>

    </mat-card>
  </div>

</div>
